# Gemini画像生成スキル アップグレード要件定義

## このスキルは何をするもの？

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   「こんな感じの画像を作って！」とお願いすると              │
│                                                             │
│   AIが自動で画像を作ってくれるツール                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 今回のアップグレード内容

**現在**: テキストだけで画像を作る

```
  あなた                        AI (Gemini)
    │                              │
    │  「夕焼けの山の絵を描いて」   │
    │ ─────────────────────────▶  │
    │                              │
    │         🖼️ 画像完成！        │
    │  ◀───────────────────────── │
```

**アップグレード後**: 参考画像を見せて「こんな感じで」と頼める

```
  あなた                                AI (Gemini)
    │                                      │
    │  📷 参考画像 + 「この雰囲気で犬を」   │
    │ ─────────────────────────────────▶  │
    │                                      │
    │   AI: この画像の特徴を分析...         │
    │   「水彩風、暖かい色、柔らかい光...」  │
    │                                      │
    │         🖼️ 同じ雰囲気の画像完成！     │
    │  ◀─────────────────────────────────  │
```

---

## なぜこの機能が必要？

```
┌────────────────────────────────────────────────────────────┐
│  😰 今までの問題                                           │
│                                                            │
│  「えーと...水彩っぽくて、オレンジと黄色の暖かい感じで、    │
│   光は右上から当たってて、ふんわりした雰囲気で...」         │
│                                                            │
│   → 言葉で説明するのが大変！                               │
│   → 伝わりにくい！                                         │
│   → 思い通りにならない！                                   │
└────────────────────────────────────────────────────────────┘
                          ↓
┌────────────────────────────────────────────────────────────┐
│  😊 アップグレード後                                        │
│                                                            │
│  「この画像みたいな雰囲気で、犬を描いて」                   │
│   📷 [参考画像をポン！]                                     │
│                                                            │
│   → 一発で伝わる！                                         │
│   → イメージ通りになる！                                   │
└────────────────────────────────────────────────────────────┘
```

---

## 処理の流れ（4ステップ）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  STEP 1: 参考画像をアップロード

  ┌─────────────┐
  │   📷        │  →  Geminiに送る
  │  参考画像    │
  └─────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  STEP 2: AIが画像の特徴を分析（YAML形式で整理）

  ┌─────────────┐      ┌──────────────────────────┐
  │   📷        │  →   │ 📋 分析結果              │
  │  参考画像    │      │                          │
  └─────────────┘      │ ・スタイル: 水彩画        │
                       │ ・色: オレンジ、黄色      │
                       │ ・雰囲気: 暖かい          │
                       │ ・光: 右上から柔らかく    │
                       └──────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  STEP 3: 最適なプロンプト（指示文）を自動作成

  ┌──────────────────────────┐      ┌─────────────────────────────┐
  │ 📋 分析結果              │      │ 📝 生成されたプロンプト      │
  │                          │  →   │                             │
  │ + あなたの希望           │      │ 「暖かいオレンジと黄色の     │
  │   「犬を描いて」         │      │  水彩画スタイルで、          │
  └──────────────────────────┘      │  右上からの柔らかい光で      │
                                    │  犬を描く」                  │
                                    └─────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  STEP 4: 画像を生成

  ┌─────────────────────────────┐      ┌─────────────┐
  │ 📝 最適化されたプロンプト   │  →   │   🖼️        │
  │                             │      │  完成画像    │
  └─────────────────────────────┘      └─────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 使い方（2パターン）

```
┌────────────────────────────────────────────────────────────┐
│  パターン① 参考画像なし（今まで通り）                      │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  あなた: 「夕焼けの海の絵を描いて」                        │
│                                                            │
│  AI: 🖼️ はい、作りました！                                 │
│                                                            │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  パターン② 参考画像あり（新機能！）                        │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  あなた: 「この画像の雰囲気で、犬を描いて」                │
│          📷 [参考画像を添付]                                │
│                                                            │
│  AI: 画像を分析中... 📋                                    │
│      プロンプト作成中... 📝                                │
│      🖼️ できました！                                       │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## AIが分析する内容（YAML形式）

```
┌────────────────────────────────────────────────────────────┐
│  YAML（ヤムル）って何？                                    │
│                                                            │
│  → 情報を整理して書く「書き方のルール」のこと              │
│  → 箇条書きのようなもの                                    │
└────────────────────────────────────────────────────────────┘

例えば、この画像を分析すると...

  📷 参考画像        →     📋 YAML形式の分析結果
  ┌──────────┐
  │ 🌅       │              スタイル:
  │ 夕焼けの  │                種類: 水彩画風
  │ 猫の絵   │                タッチ: ふんわり
  └──────────┘
                            色づかい:
                              メイン: オレンジ
                              サブ: 黄色、ピンク
                              雰囲気: 暖かい

                            構図:
                              主役: 猫（中央）
                              背景: 夕焼け空

                            光:
                              方向: 後ろから
                              強さ: やわらかい
```

---

## YAML抽出フォーマット（技術仕様）

```yaml
visual_analysis:
  composition:
    layout: "中央配置"
    aspect_ratio: "16:9"
    main_subject_position: "center"

  style:
    art_style: "写実的/イラスト/水彩/etc"
    color_palette:
      primary: "#XXXXXX"
      secondary: "#XXXXXX"
      accent: "#XXXXXX"
    mood: "明るい/暗い/温かい/クール"
    texture: "滑らか/グランジ/etc"

  subjects:
    - type: "人物/オブジェクト/風景"
      description: "詳細な説明"
      position: "left/center/right"

  lighting:
    type: "自然光/スタジオ/etc"
    direction: "正面/側面/逆光"
    intensity: "強/中/弱"

  background:
    type: "単色/グラデーション/写真"
    description: "詳細"
```

---

## パラメータ一覧

| パラメータ | 必須 | デフォルト | 説明 |
|-----------|------|-----------|------|
| `--prompt` | Yes | - | 画像生成の指示文 |
| `--output` | No | `output/generated_image.png` | 保存先 |
| `--reference-image` | No | - | 参考画像のパス（新機能） |
| `--yaml-output` | No | - | YAML分析結果の保存先 |
| `--show-browser` | No | False | ブラウザを表示（デバッグ用） |
| `--timeout` | No | 180 | 最大待機時間（秒） |

---

## 実装ファイル構成

```
scripts/
├── config.py              # 設定
├── browser_utils.py       # ブラウザ操作
├── auth_manager.py        # 認証管理
├── image_generator.py     # 画像生成（更新）
├── prompt_extractor.py    # YAML抽出（新規）
├── meta_prompt.py         # メタプロンプト生成（新規）
└── run.py                 # 実行スクリプト
```

---

## まとめ

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│  🎯 今回作る機能                                           │
│                                                            │
│  ┌──────────────────────────────────────────────────────┐ │
│  │                                                      │ │
│  │  参考画像（オプション）                               │ │
│  │       ↓                                              │ │
│  │  AIが特徴を分析                                       │ │
│  │       ↓                                              │ │
│  │  最適なプロンプトを自動生成                           │ │
│  │       ↓                                              │ │
│  │  参考画像に似た雰囲気の新しい画像を作成               │ │
│  │                                                      │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                            │
│  ※ 参考画像は「あれば使う」オプション機能                  │
│  ※ なくても今まで通り使える                                │
│                                                            │
└────────────────────────────────────────────────────────────┘
```
